---
title: ä½ ä»æœªè§è¿‡çš„å…¨æ–°ç‰ˆæœ¬
comments: true
toc: true
date: 2020-04-18 10:31:00
categories:
  - åšå®¢å¼€å‘
tags:
  - Kratos
---

ä½ ä»æœªè§è¿‡çš„å…¨æ–°ç‰ˆæœ¬ï¼Œè¿™ä¸€æ¬¡é‡æ–°å®šä¹‰æœ¬ç«™ (åˆ’æ‰ 

<!-- more--> 

åœ¨æŒ‚ç€åŸºäº `icarus` é­”æ”¹çš„ä¸»é¢˜ä¸€å¹´ä¹‹åï¼Œæˆ‘ç»ˆäºä¸‹å®šå†³å¿ƒæ¢ä¸‹ä¸€ä¸ªä¸»é¢˜ `Kratos-Rebirth`ï¼›é™æ€åšå®¢çš„æœ¬è´¨å°±æ˜¯æ¢ä¸»é¢˜ (é›¾ ã€‚åœ¨è¿™é‡Œéå¸¸æ„Ÿè°¢ [@ç³–å–µğŸ­åŒå­¦](https://candinya.com/) åœ¨æ— æ•°ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Šç§¯æåœ°ç»´æŠ¤å’Œæ›´æ–°  [Kratos-Rebirth](https://github.com/Candinya/Kratos-Rebirth)ï¼Œå¦‚æœä½ ä¹Ÿè§‰å¾—è¿™ä¸ªä¸»é¢˜å¾ˆèµï¼Œä½ åº”è¯¥å»  https://github.com/Candinya/Kratos-Rebirth ç‚¹ä¸€ä¸ªâ­ï¼Œä¸è¦å«Œéº»çƒ¦ï¼Œè¿™å¯èƒ½æ˜¯æœ€å¥½çš„æ”¯æŒæ–¹å¼ã€‚

é‚£ä¹ˆï¼Œå°±æ¥çœ‹çœ‹æœ¬æ¬¡å¦‚ä½•é‡æ–°å®šä¹‰æœ¬ç«™çš„å§ x 

### å…¨æ–°çš„é¢è²Œ

![é¦–é¡µ](https://cdn.jsdelivr.net/gh/vensing/static@master/image/agbkYHThGBAdnt4.png)


å¿…é¡»å¾—å¹ä¸€ä¸‹ï¼Œ`Kratos-Rebirth` ä¸»é¢˜æ¸²æŸ“åçš„é¡µé¢çœŸçš„å¾ˆå¥½çœ‹ï¼Œè€Œä¸”å…¨ç«™é‡‡ç”¨ pjax æŠ€æœ¯åšåˆ°äº†ç±»ä¼¼ vue å•é¡µåº”ç”¨çš„é¡µé¢æ¸²æŸ“æ•ˆæœï¼Œæé«˜äº†ç”¨æˆ·è®¿é—®é¡µé¢æ—¶çš„ä½“éªŒã€‚

<img src="https://cdn.jsdelivr.net/gh/vensing/static@master/image/5ZeynDRVbHWl6Iv.png" alt="ç§»åŠ¨ç«¯" style="zoom:25%;" />

ç§»åŠ¨ç«¯çš„é¢œå€¼å’Œä½“éªŒä¹Ÿæ˜¯éå¸¸æ£’ (à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§ï¼Œé˜…è¯»ä½“éªŒä¹Ÿå¾ˆèµã€‚æ˜¯ä¸æ˜¯æ„Ÿè§‰è·ƒè·ƒæ¬²è¯•äº† (æ“æ‰‹.jpg


### disqusjs åŸºç¡€è¯„è®ºæ¨¡å¼

![disqusjs](https://cdn.jsdelivr.net/gh/vensing/static@master/image/NVJDU6rwI5kSGCi.png)

Hexo ç­‰é™æ€åšå®¢ç”±äºæ²¡æœ‰åç«¯ç¨‹åºï¼Œå…¶ç•™è¨€è¯„è®ºæ˜¯çœŸçš„è®©äººå¾ˆçº ç»“å¾ˆå¤´å¤§ï¼Œæ€»ç»“ä¸‹æœ‰ä»¥ä¸‹å‡ ç§ä¸»æµæ–¹å¼ï¼š

- valine ç»“åˆ LeanCloud 
- gitTalk é…åˆ github
- disqus å’Œ disqusjs åŸºç¡€è¯„è®ºæ¨¡å¼

ä»¥ä¸Šä¸‰ç§æ–¹å¼éƒ½å¯ä»¥ (ä¸åšæ¯”è¾ƒ)ï¼Œæˆ‘æ¯”è¾ƒåçˆ± disqus çš„è¯„è®ºæœåŠ¡ï¼Œä½†éš¾å—çš„å°±æ˜¯ä¸å¼€ä»£ç†è¯„è®ºæœåŠ¡å°±å—å±äº†ã€‚å¯¹äºé‚£äº›æ²¡æœ‰ä»£ç†æ‰‹æ®µçš„ç”¨æˆ·æ˜¯çœ‹ä¸åˆ°å·²æœ‰çš„ç•™è¨€è¯„è®ºçš„ï¼Œè¿™ä¸€ç‚¹åŠé€€äº†å¾ˆå¤šè®¿å®¢ï¼Œä½“éªŒçœŸçš„ä¸å¥½ ( æˆ‘å®Œå…¨æ²¡æœ‰è®¿å®¢ )  ã€‚å¥½åœ¨ä¸Šæœ‰æ”¿ç­–ï¼Œä¸‹æœ‰å¯¹ç­–ï¼Œ[disqusjs](https://github.com/SukkaW/DisqusJS) æå‡ºäº†åå‘ä»£ç†çš„è§£å†³æ–¹æ¡ˆã€‚


ç°åœ¨ï¼Œæ²¡æœ‰å¼€ä»£ç†çš„è®¿å®¢ä¹Ÿèƒ½çœ‹åˆ°ç•™è¨€è¯„è®ºäº†ï¼Œå¦‚æœç¬¬ä¸€æ¬¡åŠ è½½è¯„è®ºåŸºç¡€æ¨¡å¼å¤±è´¥ï¼Œæ‚¨éœ€è¦ç‚¹å‡»é‡è½½æ‰èƒ½åŠ è½½å‡ºæ¥ï¼›å¦‚æœæ‚¨æƒ³ç•™ä¸‹ä¸€ä¸ªè¯„è®ºï¼Œæ‚¨è¿˜æ˜¯éœ€è¦å¼€ä»£ç†ï¼Œå› ä¸º disqusjs ä»…ä»…åªæ˜¯æ‹¿åˆ°è¯„è®ºåˆ—è¡¨è¿›è¡Œå±•ç¤º (æ²¡é”™ï¼Œå¦‚æœä½ çœŸçš„æƒ³ç•™ä¸‹è¯„è®ºï¼Œå¼€ä»£ç†å§ï¼Œæˆ‘çš„æœ‹å‹ã€‚è¿™é‡Œï¼Œç€é‡è®²ä¸€ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ CloudFlare æä¾›çš„å…è´¹ Worker æ¥ä»£ç† disqus çš„ API åœ°å€ (ç™½å«–çœŸçˆ½å•Šã€‚ 

#### CF Workers åå‘ä»£ç†

é¦–å…ˆï¼Œä½ éœ€è¦ç™»å½•åˆ° CloudFlareï¼Œ ç„¶åæ‰¾åˆ° Workers ï¼Œé€‰æ‹© Free è®¡åˆ’ (åœŸè±ªè¯·éšæ„é€‰æ‹©)ï¼›ç„¶åä½ å¯èƒ½éœ€è¦å¡«ä¸€ä¸ª  **xxxx.workers.dev** çš„åŸŸååœ°å€ï¼Œå¡«å¥½ä¹‹åç‚¹å‡» **åˆ›å»º Worker**ï¼Œworker åå­—éšæ„ä½†è¿™é‡Œå»ºè®®å¡« **disqusjs-api**ã€‚è¿›å…¥ç¼–è¾‘é¡µé¢ï¼ŒæŠŠ[å®˜æ–¹ç¤ºä¾‹ CF Workers åä»£é¡¹ç›®](https://github.com/idawnlight/disqusjs-proxy-cloudflare-workers/blob/master/worker.js ) é‡Œçš„å†…å®¹å¤åˆ¶åˆ°å·¦ä¾§è„šæœ¬æ¡†ä¸­ï¼Œå¼„å¥½ä¹‹åå†ç‚¹å‡»å³ä¾§å‘èµ· HTTP GET è¯·æ±‚æµ‹è¯•ï¼Œå¦‚æœå‡ºç° 200 OKï¼Œé‚£å°±è¯´æ˜æˆåŠŸäº†ã€‚ 

![CF Workers åå‘ä»£ç†](https://cdn.jsdelivr.net/gh/vensing/static@master/image/U9fgABpsERmihkt.png)

#### disqusjs é…ç½®

æˆ‘çš„ disqusjs é…ç½®å¦‚ä¸‹ï¼š

```yaml
# DisqusJS
disqusjs:
  shortname: your shorname
  sitename: your sitename
  api: https://disqusjs-api.xxxx.workers.dev/api/
  apikey: your disqus public API
  admin: Vexsy
  adminlabel: é£æœˆ
```
api è¿™é‡Œå¾—æ³¨æ„ä¸‹ï¼Œä¸æ˜¯å¡« https://disqusjs-api.xxxx.workers.dev  è€Œæ˜¯ https://disqusjs-api.xxxx.workers.dev/api/ ï¼Œè¯·åœ¨åè¾¹åŠ ä¸Š /api/ ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä»£ç†çš„æ˜¯ disqus.com/api/ ã€‚apikey åœ¨https://disqus.com/api/applications/ é¡µé¢ä¸­å¯ä»¥æ‰¾åˆ° ï¼Œè¯·ä½¿ç”¨ Public Key !!!

### æ›´åˆç†çš„æ‰˜ç®¡æ–¹å¼

ç”±äº Kratos-Rebirth ä¸»é¢˜åœ¨ç»´æŠ¤å’Œæ›´æ–°ï¼Œåç»­ä¼šæœ‰æ–°çš„åŠŸèƒ½åŠ å…¥æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¾—åŒæ­¥æ›´æ–°ï¼›ç›´æ¥æŠŠä¸»é¢˜ Clone åˆ° Blog é¡¹ç›®çš„ themes æ–‡ä»¶å¤¹ä¸‹ï¼ŒGithub å¹¶ä¸ä¼šæäº¤åµŒå¥—ä»“åº“çš„æ–‡ä»¶å¤¹ã€‚åˆ«é—®æˆ‘ä¸ºå•¥ä¸ç”¨ submoduleï¼Œæˆ‘å®Œå…¨ä¸ä¼šé‚£ä¸œè¥¿ä¹Ÿä¸æƒ³ç”¨ (ç†ç›´æ°”å£® ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘æ‰“ç®—æŠŠä¸»é¢˜ä¹Ÿæ‰˜ç®¡åœ¨ github ä»“åº“å¾—äº†ï¼Œç„¶å Travis CI build åœ¨æ‰§è¡Œ **install** æ—¶ clone ä¸‹ä¸»é¢˜æ”¾åˆ° **themes**  æ–‡ä»¶å¤¹ä¸‹å³å¯ã€‚


#### ä¸»é¢˜æ‰˜ç®¡

ä¸»é¢˜æˆ‘æ‰˜ç®¡åœ¨ [vensing/Kratos-Rebirth](https://github.com/vensing/Kratos-Rebirth)ä»“åº“ï¼Œæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼š

- master åŒæ­¥ Candinya/Kratos-Rebirth çš„æºç 
- custom æ”¾æˆ‘åšå®¢ç”¨åˆ°çš„ä¸»é¢˜ä»£ç ï¼ŒåŒ…å«ä¸€äº›è‡ªå®šä¹‰ä¿®æ”¹å’Œç§äººé…ç½®ç­‰

ä½ éœ€è¦å°† Candinya/Kratos-Rebirth æ·»åŠ ä¸ºè¿œç¨‹æºä»¥ä¾¿åŒæ­¥å…¶æ›´æ–°ï¼š

```shell 
# æ·»åŠ è¿œç¨‹æº
git remote add upstream https://github.com/Candinya/Kratos-Rebirth
# æ‹‰å–
git fetch upstream 
# èåˆ
git merge upstream/master
```

è¿™æ ·ï¼ŒCandinya/Kratos-Rebirth åº“æ›´æ–°äº†ï¼Œmaster åˆ†æ”¯åŒæ­¥ä¸‹ï¼Œæœ€ååœ¨ merge åˆ° custom åˆ†æ”¯å³å¯ã€‚ç”±äºä¸»é¢˜æ‰˜ç®¡åœ¨ Githubï¼Œå› æ­¤åšå®¢æ ¹ç›®å½•ä¸‹çš„ themes æ–‡ä»¶å¤¹ä¾¿å¯ä»¥åˆ é™¤äº†ï¼Œä½ éœ€è¦åœ¨ .gitignore æ·»åŠ é…ç½®ï¼Œå¿½ç•¥è¯¥æ–‡ä»¶å¤¹ã€‚æœ€åçš„ä¸»é¢˜ä»“åº“çš„åˆ†æ”¯å›¾å¤§æ¦‚é•¿è¿™æ ·â¬‡ï¼š

![SourceTree ä¸‹çš„åˆ†æ”¯ç»“æ„](https://cdn.jsdelivr.net/gh/vensing/static@master/image/R97WFHiOhSCsyfU.png)

#### Travis CI é…ç½®

ç”±äºä¸»é¢˜æ”¾åˆ°äº† github ä»“åº“ï¼Œæ‰€ä»¥ Travis CI çš„é…ç½®è¿˜å¾—ä¿®æ”¹ä¸‹ï¼Œå…·ä½“å°±æ˜¯åœ¨æ‰§è¡Œ **install** æ—¶ clone ä¸‹ vensing/Kratos-Rebirth åº“çš„ custom åˆ†æ”¯(è¿™ä¸ªåˆ†æ”¯æ‰åŒ…å«äº†ä¸»é¢˜çš„ç§äººé…ç½®é¡¹)ã€‚åªè¦èƒ½ä¿è¯åœ¨æ‰§è¡Œ *hexo clean && hexo g*  ä¹‹å‰æŠŠä¸»é¢˜ clone ä¸‹æ¥å³å¯ã€‚

ä»¥ä¸‹æ˜¯æˆ‘çš„Travis CI é…ç½®æ–‡ä»¶ï¼š

```yaml
language: node_js
node_js: 12.14.1 

sudo: false

cache:
  apt: true
  directories:
    - "node_modules"
 
addons:
  ssh_known_hosts:
  - github.com
  - vensing.com

notifications:
  email:
    recipients:
      - xxxx@xmail.com
    on_success: never
    on_failure: never

install:
  - npm install
  - git clone -b custom https://github.com/vensing/Kratos-Rebirth.git themes/Kratos-Rebirth

before_script:
  # è§£å¯† RSA ç§é’¥å¹¶è®¾ç½®ä¸ºæœ¬æœº ssh ç§é’¥
  - openssl aes-256-cbc -K $encrypted_xxxxxx_key -iv $encrypted_xxxxxx_iv 
    -in travis/travis.key.enc -out ~/.ssh/id_rsa -d
  - chmod 600 ~/.ssh/id_rsa
  - export TZ='Asia/Shanghai'
  - chmod +x _travis.sh

script:
  - hexo clean && hexo g

after_success:
  - rsync -rv --delete -e 'ssh -o stricthostkeychecking=no -p port' public/ root@yoursite:/www

after_script:
  - ./_travis.sh

branches:
  only:
    - source

```

è¯¦ç»†çš„é…ç½®æ–‡ä»¶åœ¨ Gist ä¸Šï¼šhttps://gist.github.com/vensing/0296bf555c794d4392c05c75ce00d17c.js

### ä¸€äº›å…¶ä»–äº‹æƒ…

åœ¨æ›´æ¢ä¸»é¢˜æ—¶ï¼Œä¹Ÿé‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼š[Kratos-Rebirth #issues-4](https://github.com/Candinya/Kratos-Rebirth/issues/4)ï¼›ç³–å–µğŸ­åŒå­¦å¾ˆæœ‰è€å¿ƒçš„éƒ½ä¿®å¤äº†ã€‚å½“ç„¶ï¼Œå’±ä¹Ÿä¸èƒ½å®Œå…¨ç™½å«–ï¼Œäºæ˜¯æäº†ä¸€ä¸ªç®€å•çš„ Pull Requestï¼š[Kratos-Rebirth #PR-3](https://github.com/Candinya/Kratos-Rebirth/pull/3)ï¼Œæ–°å¢ RSS Feed å’Œä¿®å¤äº†è¡¨æ ¼æ— æ ·å¼çš„é—®é¢˜ã€‚

å¼€æºç¡®å®ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œæ‰€ä»¥ä½ åº”è¯¥é©¬ä¸åœè¹„åœ°ç»™é‚£äº›å¥½é¡¹ç›®ç‚¹ä¸ªâ­ï¼Œæˆ–è€…ç§¯æåœ°å»å‚ä¸è´¡çŒ®ï¼›è€Œä¸æ˜¯ä¸€å‘³åœ°è¦æ±‚åˆ›ä½œè€…ä»¬è§£å†³é—®é¢˜ã€‚


æœ€åï¼Œåº†ç¥ä¸‹æœ¬ç«™ç»ˆäºæ¢äº†æ–°é¢è²Œã€‚å¥½è€¶(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§

